# NI SpecServerProxy

- [NI SpecServerProxy](#ni-specserverproxy)
  - [Who](#who)
  - [Problem Statement](#problem-statement)
  - [Proposed Solution](#proposed-solution)
  - [Implementation](#implementation)
    - [Design](#design)
    - [Dataflow](#dataflow)
  - [Installation](#installation)
  - [Establishment of Connection With SLE](#establishment-of-connection-with-sle)
  - [Exchange of Data](#exchange-of-data)
    - [Get products](#get-products)
    - [Get specification](#get-specification)
    - [Upload BDC file.](#upload-bdc-file)
  - [Open Issues](#open-issues)

## Who

Author: National Instruments <br/>
Team: ModernLab Success

## Problem Statement
 
Currently there is no workflow to exchange data between SystemLink Enterprise (SLE) and NI TestStand.

## Proposed Solution

- NI TestStand has a workflow to exchange data between itself and Specification Compliance Manager using SCM APIs.

- So, the proposed solution is to create a python server to act as a proxy which redirects the requests sent to SCM server to SLE server without affecting the TestStand-SpecificationComplianceManager (SCM) workflow.


## Implementation

### Design

- Flask server which redirects requests sent to SCM server to SLE server.
- Server uses SystemLink Python Clients to access SLE APIs.
- Endpoints to enable
  - Get products from SLE server.
  - Get available specs in a product in SLE server.
  - Upload measurement BDC file to a product in SLE server.

### Dataflow

The below picture shows data flow between SystemLink Enterprise and TestStand.

![Dataflow](DataFlow.png)

## Installation

- Follow the steps to set up [NI SystemLink Client](https://www.ni.com/docs/en-US/bundle/systemlink-enterprise/page/setting-up-systemlink-client.html#:~:text=Search%20for%20and%20install%20NI,which%20you%20want%20to%20connect)

- NI SpecServerProxy Python Package has to be installed in NI SystemLink Client's Python Site Packages.

- Run `"C:\Program Files\National Instruments\Shared\Skyline\Python\3.8\python.exe" -m pip install ni_spec_server_proxy-X_X_X-py3-none-any.whl` to install whl file.

## Establishment of Connection With SLE

- Launch NI SystemLink Client and connect to SystemLink Enterprise as per [instructions](https://www.ni.com/docs/en-US/bundle/systemlink-enterprise/page/setting-up-systemlink-client.html)

  - Configurations will be taken from SystemLink Clients.

  - If the SLE version is 2024-04 or older, update the API key in the master.json file at - "C:\ProgramData\National Instruments\Skyline\HttpConfigurations\http_master.json".

  - Refer to the [instructions to create an API key](https://www.ni.com/docs/en-US/bundle/systemlink-enterprise/page/creating-an-api-key.html)

- Run spec-server-proxy.bat file to run the server.
- Open NI TestStand Sequence Editor.
- Select *Tools > Import/Update from Specification Compliance Manager (SCM)* from the TestStand Sequence Editor menu bar.

![ToolsOption](ToolsOption.png)

- Enter the credentials in the dialog box,
  - Server - http://localhost:8000
  - API token - None

![ConnectToSLE](ConnectToSLE.png)

- On Clicking on the *Connect* button, it should be connected to Proxy Server.

## Exchange of Data

| Data Exchange      | SCM API                                                                    | Equivalent SLE API                                                                                 |
| ------------------ | -------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| Get Products       | `/niscm/public/products`                                                   | `/v2/products`                                                                                     |
| Get Specifications | `/niscm/public/spec/<product_name>/<product_revision>`                     | `/nispec/v1/query-specs`                                                                           |
| Upload BDC file    | `/niscm/public/data/upload/<product_name>/<product_revision>/<discipline>` | `/v1/service-groups/Default/upload-files` <br/> To link the file to product: `/v2/update-products` |

### Get products

- After the establishment of connection, all the products' PartNumber available in the SLE server should be listed down.

![GetProduct](GetProducts.png)

### Get specification

- On selecting a PartNumber and Category from the dropped down list, the specifications available in the selected product should be loaded.

![SelectProduct](SelectProduct.png)

- The available specifications in the product should be imported into FileGlobals.SCM_Specifications in TestStand.

### Upload BDC file.

On following the below steps, BDC file generated by TestStand should be uploaded to SLE server.

- Ensure SCM Data in Result Processing is enabled.

![ResultProcessing](ResultProcessing.png)

- In TestStand, create a simple sequence which generates random numbers as measurement for a spec.
- Run the sequence to generate and upload the measurement to SLE.
- Once the sequence is run, the user can view the measurements as BDC files in the respective product under *Files* tab in SLE.

![UploadedFile.png](UploadedFile.png)

- Once the BDC file is uploaded, the routine will create a test result and steps using the file and the result will be available under the *Results* tab.

- The uploaded files will be stored locally.

## Open Issues

No open issues.